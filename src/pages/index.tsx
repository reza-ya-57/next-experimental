import { Button } from '@mui/material';
import type { NextPage } from 'next';
import Head from 'next/head'
import Link from 'next/link'
import styles from '../../styles/Home.module.css'
import axios from 'axios';
import { useState, useEffect } from 'react';
//Redux



const Home: NextPage = () => {

  const [state, setState] = useState('');
  const [token , setToken] = useState('');
  const [excel , setExcel] = useState<any>('');
  const [jokeWithHadi, setJokeWithHadi] = useState("Sent Get Request")

  const requestBody = {
    email: 'sean.maxwell@gmail.com',
    password: 'Password@1'
  }

  const loginHandler = async () => {
    // debugger
    axios.post('http://localhost:3000/api/auth/login', requestBody)
      .then(res => {
        console.log(res.data)
        setToken(res.data.token)
        console.log(res.data.token)
      })
      .catch(err => {
        console.log(err.message)
      })

  }
  useEffect(() => {
    //  loginHandler(requestBody)
  }, [])

  const onFileChange = event => {
        
    setExcel({ selectedFile: event.target.files[0] });
};

  const getRequestHandler = () => {
    axios.get("/test")
      .then(res => {
        console.log(res.data);
        setState(res?.data)
        setJokeWithHadi("Click Harder Hadi")
      })
  }

  const fetchHandler = () => {
    axios.get('http://localhost:3000/api/sql/fetch', { headers: { 'Authorization': 'Bearer ' + token } })
      .then(res => {
        console.log(res)
      })
      .catch(err => {
        console.log(err.message)
      })
  }


  const excelHandler = () => {
    const formData = new FormData();

    formData.append("SampleFile", excel.selectedFile);

    axios.post('http://localhost:3000/api/sql/excel', formData , { headers: { 
      'Authorization': 'Bearer ' + token ,

    } })
      .then(res => {
        console.log(res)
      })
      .catch(err => {
        console.log(err.message)
      })
  }
  
  return (
    <div>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main>
        <div className={styles.Lorem}>
          test
        </div>
        <h1>سلام </h1>
        <Link href='/posts/first-post' >
          <a className={styles.link} >رفتن به صفحه پست </a>
        </Link>
        <Button variant='contained' onClick={getRequestHandler} >
          {jokeWithHadi}
        </Button>
        <br />
        Hello
        <br />
        <Button
          variant='contained'
          onClick={loginHandler}
        >
          Login
        </Button>
        <Button
          variant='contained'
          onClick={fetchHandler}
        >
          fetch
        </Button>
        <input type="file" onChange={onFileChange} accept=".xlsx, .xls, .csv" />
        <Button
          variant='contained'
          onClick={excelHandler}
        >
          upload excel
        </Button>
        
      </main>
    </div>
  )
}

export default Home
